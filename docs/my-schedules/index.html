<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Schedule</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    /* =========================================================
       My Schedule â€” v5 Full Redesign (same homepage style)
       Mobile-first + Big desktop
       ========================================================= */
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#f6f8fc;
      --card:#ffffff;
      --ink:#0b162a;
      --muted:#64748b;
      --border:#e6ebf2;
      --shadow:0 10px 30px rgba(11,22,42,.08);
      --shadow2:0 18px 60px rgba(11,22,42,.16);
      --r:18px;

      --navy:#0a1628;
      --blue:#1d4ed8;
      --cyan:#06b6d4;

      --container:1120px;
      --pad:clamp(14px, 3.6vw, 26px);
      --gap:clamp(10px, 2.6vw, 16px);
    }

    body{
      font-family:"Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(29,78,216,.12), transparent 45%),
        radial-gradient(900px 520px at 95% 0%, rgba(6,182,212,.10), transparent 45%),
        var(--bg);
      color:var(--ink);
      min-height:100vh;
      font-size:clamp(13px, 1.2vw, 15px);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    body.ar{direction:rtl;}
    a{color:inherit}
    button,input,select{font-family:inherit}

    .container{width:min(var(--container), 100%); margin:0 auto; padding:0 var(--pad)}
    .stack{display:flex; flex-direction:column; gap:var(--gap)}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      background:linear-gradient(135deg, var(--navy), #153257);
      border-bottom:1px solid rgba(255,255,255,.08);
      box-shadow:0 2px 14px rgba(10,22,40,.18);
    }
    .topbar-inner{
      height:clamp(58px, 6vw, 70px);
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .brand{display:flex; align-items:center; gap:12px; color:#fff; min-width:0}
    .brand-badge{
      width:clamp(36px, 4.6vw, 44px);
      height:clamp(36px, 4.6vw, 44px);
      border-radius:14px;
      background:linear-gradient(135deg,var(--blue),var(--cyan));
      display:grid; place-items:center;
      box-shadow:0 10px 22px rgba(29,78,216,.28);
      flex:0 0 auto;
      font-size:18px;
    }
    .brand-text{min-width:0}
    .brand-title{
      font-size:15px; font-weight:900; letter-spacing:-.2px; line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand-sub{
      margin-top:2px;
      font-size:11px; font-weight:700;
      color:rgba(255,255,255,.72);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .top-actions{display:flex; align-items:center; gap:8px; flex:0 0 auto}

    /* Buttons */
    .btn{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10);
      color:#fff;
      border-radius:14px;
      padding:10px 12px;
      font-size:12px;
      font-weight:900;
      cursor:pointer;
      transition:transform .15s, background .15s, border-color .15s, box-shadow .15s;
      white-space:nowrap;
    }
    .btn:hover{background:rgba(255,255,255,.18); transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn.primary{
      border:0;
      background:linear-gradient(135deg,var(--blue),var(--cyan));
      box-shadow:0 10px 20px rgba(29,78,216,.28);
    }
    .btn.ghost{background:transparent}
    .btn2{
      border:1px solid var(--border);
      background:#fff;
      color:var(--ink);
      border-radius:14px;
      padding:10px 12px;
      font-size:12px;
      font-weight:1000;
      cursor:pointer;
      transition:transform .15s, box-shadow .15s, border-color .15s;
      white-space:nowrap;
    }
    .btn2:hover{transform:translateY(-1px); box-shadow:0 12px 18px rgba(11,22,42,.08); border-color:#d9e2ef}
    .btn2.primary{border:0; color:#fff; background:linear-gradient(135deg,var(--blue),var(--cyan))}

    /* Hero (single, homepage style) */
    .hero{padding:18px 0 12px}
    .hero-card{
      background:linear-gradient(135deg, rgba(10,22,40,.88), rgba(30,58,95,.86));
      border:1px solid rgba(255,255,255,.12);
      border-radius:calc(var(--r) + 2px);
      box-shadow:var(--shadow2);
      padding:clamp(14px, 2.6vw, 22px);
      color:#fff;
      position:relative;
      overflow:hidden;
    }
    .hero-card::after{
      content:"";
      position:absolute; inset:-70px -70px auto auto;
      width:240px; height:240px;
      background:
        radial-gradient(circle at 30% 30%, rgba(6,182,212,.38), transparent 55%),
        radial-gradient(circle at 60% 60%, rgba(29,78,216,.38), transparent 55%);
      transform:rotate(10deg);
      pointer-events:none;
    }
    .hero-row{display:flex; align-items:flex-start; justify-content:space-between; gap:14px; flex-wrap:wrap; position:relative; z-index:1}
    .hero-left{display:flex; align-items:flex-start; gap:12px; min-width:0}

    /* Hide hero copy outside (kept only in modal) */
    .hero-copy-out{display:none}

    .hero-ico{
      width:46px; height:46px; border-radius:16px;
      background:rgba(255,255,255,.12);
      display:grid; place-items:center;
      font-size:20px;
      border:1px solid rgba(255,255,255,.14);
      flex:0 0 auto;
    }
    .hero-title{
      font-size:clamp(16px, 1.7vw, 20px);
      font-weight:1000;
      letter-spacing:-.3px;
      line-height:1.2;
    }
    .hero-desc{
      margin-top:6px;
      color:rgba(255,255,255,.78);
      font-size:12px;
      font-weight:700;
      line-height:1.6;
      max-width:70ch;
    }
    .hero-right{display:flex; gap:8px; align-items:center; flex:0 0 auto}

    /* Search + month in the SAME container */
    .searchWrap{margin-top:14px; display:flex; flex-direction:column; gap:10px; position:relative; z-index:1}
    .searchRow{
      display:flex; gap:10px; align-items:stretch; flex-wrap:wrap;
    }
    .input{
      flex:0 1 220px;
      max-width:240px;
      min-width:160px;
      border-radius:16px;
      border:1.5px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.10);
      color:#fff;
      padding:12px 14px;
      font-size:14px;
      font-weight:800;
      outline:none;
      direction:ltr;
      transition:box-shadow .15s, border-color .15s, background .15s;
    }
    .input::placeholder{color:rgba(255,255,255,.42); font-weight:700}
    .input:focus{
      border-color:rgba(59,130,246,.75);
      background:rgba(255,255,255,.14);
      box-shadow:0 0 0 4px rgba(59,130,246,.20);
    }
    .helpBtn{
      width:48px;
      display:grid; place-items:center;
      border-radius:16px;
      padding:0;
    }
    .goBtn{flex:0 0 auto}

    .monthRow{
      display:none;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      padding-top:10px;
      border-top:1px solid rgba(255,255,255,.12);
    }
    .monthLeft{display:flex; align-items:center; gap:8px}
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      border:1px solid var(--border);
      background:#f8fafc;
      color:var(--muted);
      border-radius:999px;
      padding:6px 10px;
      font-size:11px; font-weight:900;
      white-space:nowrap;
    }
    .monthLbl{color:rgba(255,255,255,.78); font-size:12px; font-weight:900}
    .monthRight{display:flex; align-items:center; gap:8px; flex-wrap:wrap}

    .m-btn{
      width:40px; height:40px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10);
      color:#fff;
      cursor:pointer;
      font-size:16px;
      display:grid; place-items:center;
      transition:transform .15s, background .15s;
    }
    .m-btn:hover{background:rgba(255,255,255,.16); transform:translateY(-1px)}
    .m-btn:disabled{opacity:.4; cursor:not-allowed; transform:none}
    .m-sel{
      height:40px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10);
      color:#fff;
      padding:8px 12px;
      font-size:12px;
      font-weight:900;
      cursor:pointer;
      min-width:clamp(180px, 24vw, 260px);
      appearance:none;
      outline:none;
      text-align:center;
    }

    /* Main */
    main{padding:10px 0 26px}
    .mainGrid{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:var(--gap);
      align-items:start;
    }
    @media(max-width: 980px){ .mainGrid{grid-template-columns:1fr} }

    /* Banner (employee info) */
    .banner{
      background:linear-gradient(135deg, rgba(10,22,40,.06), rgba(29,78,216,.05));
      border:1px solid var(--border);
      border-radius:var(--r);
      padding:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .bLeft{display:flex; align-items:center; gap:12px; min-width:0}
    .avatar{
      width:54px; height:54px; border-radius:18px;
      background:linear-gradient(135deg,var(--blue),var(--cyan));
      display:grid; place-items:center;
      color:#fff; font-weight:1000; font-size:20px;
      box-shadow:0 12px 26px rgba(29,78,216,.25);
      flex:0 0 auto;
    }
    .bName{
      font-size:clamp(16px, 1.6vw, 20px);
      font-weight:1000;
      letter-spacing:-.25px;
      line-height:1.15;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
      max-width:min(660px, 78vw);
    }
    .bMeta{margin-top:6px; display:flex; flex-wrap:wrap; gap:8px}
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:14px;
      padding:7px 10px;
      font-size:11px;
      font-weight:900;
      color:var(--muted);
      white-space:nowrap;
      max-width:92vw;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .bRight{display:flex; gap:8px; align-items:center}

    /* Calendar */
    .cal{overflow:hidden}
    .cal-head{
      display:grid; grid-template-columns:repeat(7,1fr);
      background:linear-gradient(135deg, var(--navy), #123055);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .cal-head div{
      padding:12px 6px;
      text-align:center;
      font-size:11px;
      font-weight:1000;
      letter-spacing:.4px;
      color:rgba(255,255,255,.80);
      white-space:nowrap;
    }
    .cal-body{
      display:grid;
      grid-template-columns:repeat(7, 1fr);
      background:var(--border);
      gap:1px;
    }
    .day{
      background:#fff;
      min-height:clamp(86px, 9vw, 120px);
      padding:8px 7px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      position:relative;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .day:hover{transform:translateY(-1px); box-shadow:0 10px 18px rgba(11,22,42,.06); z-index:1}
    .day.empty{background:#fbfcfe; box-shadow:none; transform:none}
    .day .top{display:flex; align-items:center; justify-content:space-between; width:100%}
    .dnum{font-weight:1000; font-size:13px; letter-spacing:-.2px}
    .ico{font-size:18px; line-height:1}

    /* Today marker: top strip (won't cover number/icon) */
    .day.today::before{
      content:"";
      position:absolute; left:0; right:0; top:0;
      height:5px;
      background:linear-gradient(135deg,var(--blue),var(--cyan));
      opacity:.95;
      pointer-events:none;
    }

    .tag{
      display:inline-flex; align-items:center; justify-content:center;
      font-weight:1000;
      font-size:11px;
      border-radius:12px;
      padding:6px 10px;
      border:1px solid transparent;
      letter-spacing:.25px;
      white-space:nowrap;
      max-width:100%;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* shift themes */
    .s-morning   {background:#fffbf0}
    .s-afternoon {background:#fff8f5}
    .s-night     {background:#faf5ff}
    .s-off       {background:#f8fafc}
    .s-leave     {background:#f0fdf4}
    .s-training  {background:#f0f9ff}
    .s-standby   {background:#fdf2f8}
    .s-other     {background:#fbfcfe}

    .s-morning   .tag{color:#b45309;background:#fef3c7;border-color:#fde68a}
    .s-afternoon .tag{color:#c2410c;background:#ffedd5;border-color:#fed7aa}
    .s-night     .tag{color:#5b21b6;background:#ede9fe;border-color:#ddd6fe}
    .s-off       .tag{color:#475569;background:#e2e8f0;border-color:#cbd5e1}
    .s-leave     .tag{color:#15803d;background:#dcfce7;border-color:#bbf7d0}
    .s-training  .tag{color:#1d4ed8;background:#dbeafe;border-color:#bfdbfe}
    .s-standby   .tag{color:#be185d;background:#fce7f3;border-color:#fbcfe8}
    .s-other     .tag{color:#6b7280;background:#f3f4f6;border-color:#e5e7eb}

    @media(max-width: 520px){
      .cal-head div{padding:10px 4px; font-size:10px}
      .day{padding:7px 6px}
      .ico{font-size:16px}
      .tag{font-size:10px; padding:5px 9px}
    }

    /* Panels */
    .panel-head{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(135deg,#ffffff,#fbfdff);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .panel-title{
      font-size:11px;
      font-weight:1000;
      letter-spacing:.9px;
      text-transform:uppercase;
      color:var(--muted);
    }

    /* Stats accordion (tall, minimal) */
    .statsSide{position:sticky; top:86px}
    @media(max-width: 980px){ .statsSide{position:static} }

    .acc{padding:12px}
    details.acc-item{
      border:1px solid var(--border);
      border-radius:16px;
      background:#fff;
      overflow:hidden;
    }
    details.acc-item + details.acc-item{margin-top:10px}
    details.acc-item summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight:1000;
      user-select:none;
    }
    details.acc-item summary::-webkit-details-marker{display:none}
    .acc-left{display:flex; align-items:center; gap:10px; min-width:0}
    .acc-ico{width:38px;height:38px;border-radius:16px;display:grid;place-items:center;font-size:18px; flex:0 0 auto}
    .acc-lbl{font-size:12px; font-weight:1000; color:var(--ink); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .acc-val{font-size:14px; font-weight:1000; color:var(--muted)}
    .acc-body{padding:0 12px 12px; color:var(--muted); font-size:12px; font-weight:700; line-height:1.6}

    /* Legend */
    .legend{padding:14px 16px 16px}
    .legend-grid{display:flex; flex-wrap:wrap; gap:8px}
    .leg{
      display:inline-flex; align-items:center; gap:7px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:7px 10px;
      font-size:11px;
      font-weight:900;
      color:var(--muted);
      white-space:nowrap;
    }
    .l-dot{width:10px; height:10px; border-radius:4px}

    /* Bottom toolbar */
    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      padding:12px;
    }
    .toolbtn{
      flex:1;
      min-width:clamp(140px, 18vw, 210px);
      border:1px solid var(--border);
      background:#fff;
      border-radius:16px;
      padding:12px 10px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition:transform .15s, box-shadow .15s, border-color .15s;
      font-weight:1000;
    }
    .toolbtn:hover{transform:translateY(-1px); box-shadow:0 12px 18px rgba(11,22,42,.08); border-color:#d9e2ef}
    .toolbtn .ti{font-size:20px}
    .toolbtn.primary{
      border:0;
      color:#fff;
      background:linear-gradient(135deg,var(--blue),var(--cyan));
      box-shadow:0 12px 22px rgba(29,78,216,.22);
    }
    @media(max-width: 520px){
      .toolbtn{min-width:100%}
    }

    /* Empty / Loading */
    .state{padding:46px 16px; text-align:center}
    .state-ico{font-size:44px; opacity:.9}
    .state h3{margin-top:10px; font-size:18px; font-weight:1000; letter-spacing:-.2px}
    .state p{margin-top:6px; font-size:12px; font-weight:700; color:var(--muted); line-height:1.6; max-width:52ch; margin-left:auto; margin-right:auto}
    .spin{
      width:38px;height:38px;border:3px solid var(--border);
      border-top-color:var(--blue);border-radius:50%;
      animation:spin 1s linear infinite;margin:0 auto 12px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Modal */
    .modal{position:fixed; inset:0; z-index:9998; display:none; align-items:center; justify-content:center; padding:var(--pad);}
    .modal-backdrop{position:absolute; inset:0; background:rgba(2,6,23,.55); backdrop-filter: blur(4px);}
    .modal-card{
      position:relative;
      width:min(640px, 100%);
      background:#fff;
      border:1px solid var(--border);
      border-radius:22px;
      box-shadow:0 26px 80px rgba(2,6,23,.35);
      overflow:hidden;
      animation:up .22s cubic-bezier(.22,1,.36,1);
    }
    @keyframes up{from{opacity:0; transform:translateY(14px)} to{opacity:1; transform:translateY(0)}}
    .modal-head{
      padding:14px 16px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(135deg,#ffffff,#fbfdff);
    }
    .modal-title{font-size:14px; font-weight:1000; letter-spacing:-.2px; color:var(--ink)}
    .modal-sub{margin-top:4px; font-size:12px; font-weight:700; color:var(--muted); line-height:1.6}
    .modal-x{
      width:40px; height:40px; border-radius:16px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      font-weight:1000;
    }
    .modal-body{padding:14px 16px 16px}
    .modal-intro{
      border:1px solid var(--border);
      background:linear-gradient(135deg,#ffffff,#fbfdff);
      border-radius:16px;
      padding:12px 12px;
      margin-bottom:12px;
    }
    .modal-intro-title{font-size:14px;font-weight:1000;letter-spacing:-.2px;color:var(--ink)}
    .modal-intro-desc{margin-top:6px;font-size:12px;font-weight:700;color:var(--muted);line-height:1.65}
    .tip{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:16px;
      background:linear-gradient(135deg, #ffffff, #fbfdff);
    }
    .tip + .tip{margin-top:10px}
    .tip-ico{font-size:18px; width:26px; text-align:center; margin-top:1px}
    .tip-text{font-size:12px; color:var(--muted); line-height:1.6; font-weight:800}
    .modal-foot{padding:12px 16px 16px; display:flex; justify-content:flex-end; gap:10px}

    /* Toast */
    .toast{
      position:fixed;
      inset:auto var(--pad) 18px var(--pad);
      display:flex;
      justify-content:center;
      z-index:9999;
      pointer-events:none;
    }
    .toast > .toast-card{
      pointer-events:auto;
      width:min(560px, 100%);
      background:linear-gradient(135deg, var(--navy), #153257);
      color:#fff;
      border:1px solid rgba(255,255,255,.12);
      border-radius:20px;
      box-shadow:0 18px 56px rgba(10,22,40,.35);
      padding:14px 14px 12px;
      animation:up .22s cubic-bezier(.22,1,.36,1);
    }
    .toast-row{display:flex; align-items:flex-start; gap:12px}
    .toast-ico{
      width:40px;height:40px;border-radius:16px;
      display:grid;place-items:center;
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.16);
      flex:0 0 auto;
      font-size:18px;
    }
    .toast p{font-size:12.5px; font-weight:800; line-height:1.55; color:rgba(255,255,255,.86)}
    .toast strong{color:#fff}
    .toast-actions{display:flex; gap:10px; margin-top:10px}
    .tbtn{
      flex:1;
      border-radius:16px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:1000;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.10);
      color:#fff;
      transition:transform .12s, background .12s;
    }
    .tbtn:hover{transform:translateY(-1px); background:rgba(255,255,255,.16)}
    .tbtn.primary{border:0; background:linear-gradient(135deg,var(--blue),var(--cyan))}
    .tbtn.primary:hover{filter:brightness(1.06)}

    /* Print */
    @media print{
      .topbar,.hero,.toast,.statsSide,.toolbtn,.toolbar,.modal{display:none!important}
      body{background:#fff}
      .card{box-shadow:none}
      main{padding:0}
    }
  
/* Clean single-line search layout */
.searchRow{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:nowrap;
}

.helpCircle{
      width:48px;
      height:48px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      padding:0;
      border:0;
      background:linear-gradient(135deg,#1d4ed8,#06b6d4);
      color:#fff;
      box-shadow:0 8px 18px rgba(29,78,216,.35);
      transition:transform .15s, box-shadow .15s, filter .15s;
    }
    .helpCircle:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 24px rgba(29,78,216,.45);
      filter:brightness(1.05);
    }
    .helpCircle:active{
      transform:translateY(0);
      box-shadow:0 6px 14px rgba(29,78,216,.3);
    }

@media(max-width:600px){
  .searchRow{
    gap:8px;
  }
  .input{
    flex:1 1 auto;
  }
}


/* Equal square buttons for View and Help */
.goBtn{
  width:48px;
  height:48px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0;
  font-size:20px;
}

.helpCircle{
  width:48px;
  height:48px;
}

</style>
</head>

<body>
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <div class="brand-badge">ğŸ“…</div>
        <div class="brand-text">
          <div class="brand-title" id="ttl">My Schedule</div>
          <div class="brand-sub" id="sub">Enter your Employee ID</div>
        </div>
      </div>
      <div class="top-actions">
        <button class="btn ghost" type="button" onclick="toggleLang()" id="langBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        <button class="btn" type="button" onclick="goBack()" id="backBtn">â† Back</button>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <div class="hero-card">
        <div class="hero-row">
          <div class="hero-left">
            
            <div class="hero-copy-out" style="min-width:0"></div>
          </div>
          <div class="hero-right">
            
          </div>
        </div>

        <div class="searchWrap">
          
<form class="searchRow" id="searchForm">
  <input class="input" id="empId" inputmode="numeric" autocomplete="off"
         placeholder="e.g. 12345" pattern="[0-9]+" required />

  <button class="btn primary goBtn" type="submit" id="sbtn">
    ğŸ”
  </button>

  <button class="btn2 helpCircle" type="button" onclick="openTips()" aria-label="Help">
    â”
  </button>
</form>


          <div class="monthRow" id="monthRow">
            <div class="monthLeft">
              <span class="pill" id="monthPill">ğŸ—“ï¸</span>
              <span class="monthLbl" id="monthLbl">Month</span>
            </div>
            <div class="monthRight">
              <button class="m-btn" type="button" id="mPrev" onclick="chMonth(-1)" aria-label="Prev month">â€¹</button>
              <select class="m-sel" id="mSel" onchange="jumpMonth(this.value)" aria-label="Month select"></select>
              <button class="m-btn" type="button" id="mNext" onclick="chMonth(1)" aria-label="Next month">â€º</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tips Modal -->
    <div class="modal" id="tipsModal" role="dialog" aria-modal="true" aria-labelledby="tipsTitleModal">
      <div class="modal-backdrop" onclick="closeTips()"></div>
      <div class="modal-card" role="document">
        <div class="modal-head">
          <div>
            <div class="modal-title" id="tipsTitleModal">Tips</div>
            <div class="modal-sub" id="tipsSub">Quick help for using the roster.</div>
          </div>
          <button class="modal-x" type="button" onclick="closeTips()" aria-label="Close">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="modal-intro">
            <div class="modal-intro-title" id="miTitle">Your roster in one view</div>
            <div class="modal-intro-desc" id="miDesc">Enter your Employee ID to view the month, then export it as PDF / Image or add it to your calendar.</div>
          </div>
          <div class="tip">
            <div class="tip-ico">ğŸ’¾</div>
            <div class="tip-text" id="tip1">Save your Employee ID once â€” it will load automatically next time.</div>
          </div>
          <div class="tip">
            <div class="tip-ico">ğŸ–¼ï¸</div>
            <div class="tip-text" id="tip2">Image export produces a clean card with header, calendar, legend, and stats.</div>
          </div>
          <div class="tip">
            <div class="tip-ico">ğŸ“†</div>
            <div class="tip-text" id="tip3">Use ICS export to add shifts to Apple/Google/Outlook calendars.</div>
          </div>
        </div>
        <div class="modal-foot">
          <button class="btn2 primary" type="button" onclick="closeTips()" id="tipsOk">OK</button>
        </div>
      </div>
    </div>
  </section>

  <main>
    <div class="container">
      <div id="area" class="stack">
        <div class="card state">
          <div class="state-ico">ğŸ“†</div>
          <h3 id="e1">Search your schedule</h3>
          <p id="e2">Enter your Employee ID above to view your monthly roster.</p>
        </div>
      </div>
    </div>
  </main>

  <div class="toast" id="toastMount" style="display:none"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    /* =========================
       Data + i18n
       ========================= */
    let data=null, month=null, months=[], lang='en';

    const COLORS={
      Morning:       {icon:'â˜€ï¸', dot:'#f59e0b'},
      Afternoon:     {icon:'ğŸŒ¤ï¸', dot:'#f97316'},
      Night:         {icon:'ğŸŒ™', dot:'#7c3aed'},
      'Off Day':     {icon:'ğŸ–ï¸', dot:'#94a3b8'},
      'Annual Leave':{icon:'âœˆï¸', dot:'#22c55e'},
      'Sick Leave':  {icon:'ğŸ¤’', dot:'#22c55e'},
      Training:      {icon:'ğŸ“š', dot:'#3b82f6'},
      Standby:       {icon:'ğŸ§', dot:'#ec4899'},
      Other:         {icon:'â“', dot:'#9ca3af'}
    };

    const STAT_META=[
      {k:'work',     icon:'ğŸ’¼', bg:'#eff6ff', label_en:'Work Days', label_ar:'Ø£ÙŠØ§Ù… Ø¹Ù…Ù„'},
      {k:'off',      icon:'ğŸ›Œ', bg:'#f8fafc', label_en:'Days Off',  label_ar:'Ø¥Ø¬Ø§Ø²Ø§Øª'},
      {k:'morning',  icon:'â˜€ï¸', bg:'#fffbf0', label_en:'Morning',   label_ar:'ØµØ¨Ø§Ø­ÙŠ'},
      {k:'afternoon',icon:'ğŸŒ¤ï¸', bg:'#fff8f5', label_en:'Afternoon', label_ar:'Ù…Ø³Ø§Ø¦ÙŠ'},
      {k:'night',    icon:'ğŸŒ™', bg:'#faf5ff', label_en:'Night',     label_ar:'Ù„ÙŠÙ„ÙŠ'},
      {k:'standby',  icon:'ğŸ§', bg:'#fdf2f8', label_en:'Standby',   label_ar:'Ø§Ø­ØªÙŠØ§Ø·'},
      {k:'leaves',   icon:'âœˆï¸', bg:'#f0fdf4', label_en:'Leaves',    label_ar:'Ø¥Ø¬Ø§Ø²Ø§Øª Ø³Ù†ÙˆÙŠØ©/Ù…Ø±Ø¶ÙŠØ©'}
    ];

    const T={
      en:{
        title:'My Schedule',
        sub:'Enter your Employee ID',
        heroTitle:'Your roster in one view',
        heroDesc:'Enter your Employee ID to view the month, then export it as PDF / Image or add it to your calendar.',
        tipsTitle:'Help & Tips',
        tipsSub:'Quick help for using the roster.',
        langBtn:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
        back:'â† Back',
        ph:'e.g. 12345',
        sbtn:'ğŸ“… View',
        tipsBtn:'â” Tips',
        month:'Month',
        loading:'Loadingâ€¦',
        notFound:'Employee not found',
        notFoundSub:'ID not in the system. Please check and try again.',
        e1:'Search your schedule',
        e2:'Enter your Employee ID above to view your monthly roster.',
        statsTitle:'Statistics',
        legendTitle:'Legend',
        actionsTitle:'Downloads',
        pdf:'Download PDF',
        img:'Download Image',
        ics:'Export ICS',
        share:'Share Link',
        print:'Print',
        changeId:'Change My ID',
        setAsMyId:'Set as My ID',
        dept:'Department',
        id:'ID',
        days:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],
        months:['January','February','March','April','May','June','July','August','September','October','November','December'],
        legend:{Morning:'Morning',Afternoon:'Afternoon',Night:'Night','Off Day':'Day Off','Annual Leave':'Annual Leave','Sick Leave':'Sick Leave',Training:'Training',Standby:'Standby',Other:'Other'},
        saveTitle:'Save your ID?',
        saveSub:'Save it to open your schedule faster next time.',
        saveYes:'âœ… Yes, save',
        saveNo:'Not now'
      },
      ar:{
        title:'Ø¬Ø¯ÙˆÙ„ÙŠ',
        sub:'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ',
        heroTitle:'Ø¬Ø¯ÙˆÙ„Ùƒ ÙÙŠ Ø¹Ø±Ø¶ ÙˆØ§Ø­Ø¯',
        heroDesc:'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø±ØŒ Ø«Ù… Ø­Ù…Ù‘Ù„ PDF/ØµÙˆØ±Ø© Ø£Ùˆ Ø£Ø¶ÙÙ‡ Ù„Ù„ØªÙ‚ÙˆÙŠÙ….',
        tipsTitle:'Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆÙ†ØµØ§Ø¦Ø­',
        tipsSub:'Ù…Ø³Ø§Ø¹Ø¯Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„.',
        langBtn:'English',
        back:'Ø±Ø¬ÙˆØ¹ â†',
        ph:'Ù…Ø«Ø§Ù„: 12345',
        sbtn:'ğŸ“… Ø¹Ø±Ø¶',
        tipsBtn:'â” Ù†ØµØ§Ø¦Ø­',
        month:'Ø§Ù„Ø´Ù‡Ø±',
        loading:'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦',
        notFound:'Ù„Ù… ÙŠÙØ¹Ø«Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ¸Ù',
        notFoundSub:'Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…. ØªØ­Ù‚Ù‚ ÙˆØ£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.',
        e1:'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¬Ø¯ÙˆÙ„Ùƒ',
        e2:'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ù…Ù†Ø§ÙˆØ¨Ø§ØªÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©.',
        statsTitle:'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª',
        legendTitle:'Ø§Ù„Ø¯Ù„ÙŠÙ„',
        actionsTitle:'Ø§Ù„ØªØ­Ù…ÙŠÙ„',
        pdf:'ØªØ­Ù…ÙŠÙ„ PDF',
        img:'ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©',
        ics:'ØªØµØ¯ÙŠØ± ICS',
        share:'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø·',
        print:'Ø·Ø¨Ø§Ø¹Ø©',
        changeId:'ØªØºÙŠÙŠØ± Ø±Ù‚Ù…ÙŠ',
        setAsMyId:'Ø§Ø­ÙØ¸ ÙƒØ±Ù‚Ù…ÙŠ',
        dept:'Ø§Ù„Ù‚Ø³Ù…',
        id:'Ø§Ù„Ø±Ù‚Ù…',
        days:['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'],
        months:['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'],
        legend:{Morning:'ØµØ¨Ø§Ø­ÙŠ',Afternoon:'Ù…Ø³Ø§Ø¦ÙŠ',Night:'Ù„ÙŠÙ„ÙŠ','Off Day':'Ø¥Ø¬Ø§Ø²Ø©','Annual Leave':'Ø³Ù†ÙˆÙŠØ©','Sick Leave':'Ù…Ø±Ø¶ÙŠØ©',Training:'ØªØ¯Ø±ÙŠØ¨',Standby:'Ø§Ø­ØªÙŠØ§Ø·ÙŠ',Other:'Ø£Ø®Ø±Ù‰'},
        saveTitle:'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­ÙØ¸ Ø§Ù„Ø±Ù‚Ù…ØŸ',
        saveSub:'Ø§Ø­ÙØ¸Ù‡ Ù„ÙØªØ­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø³Ø±Ø¹Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.',
        saveYes:'âœ… Ù†Ø¹Ù…ØŒ Ø§Ø­ÙØ¸',
        saveNo:'Ù„ÙŠØ³ Ø§Ù„Ø¢Ù†'
      }
    };

    function t(k){ return T[lang][k]; }
    function esc(s){ return String(s ?? '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    function applyLangUI(){
      document.documentElement.lang = lang;
      document.documentElement.dir  = lang==='ar' ? 'rtl' : 'ltr';
      document.body.classList.toggle('ar', lang==='ar');

      document.getElementById('ttl').textContent = t('title');
      document.getElementById('sub').textContent = t('sub');
      document.getElementById('langBtn').textContent = t('langBtn');
      document.getElementById('backBtn').textContent = t('back');

      const ht=document.getElementById('heroTitle'); if(ht) ht.textContent=t('heroTitle');
      const hd=document.getElementById('heroDesc'); if(hd) hd.textContent=t('heroDesc');
      document.getElementById('tipsBtn').textContent   = t('tipsBtn');

      document.getElementById('empId').placeholder = t('ph');
      document.getElementById('viewTxt').textContent  = t('sbtn');

      const e1=document.getElementById('e1'), e2=document.getElementById('e2');
      if(e1) e1.textContent = t('e1');
      if(e2) e2.textContent = t('e2');

      document.getElementById('tipsTitleModal').textContent = t('tipsTitle');
      document.getElementById('tipsSub').textContent = t('tipsSub');
      document.getElementById('miTitle').textContent = t('heroTitle');
      document.getElementById('miDesc').textContent  = t('heroDesc');

      document.getElementById('tip1').textContent = (lang==='ar'
        ? 'Ø§Ø­ÙØ¸ Ø±Ù‚Ù…Ùƒ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© â€” ÙˆØ³ÙŠØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.'
        : 'Save your Employee ID once â€” it will load automatically next time.');
      document.getElementById('tip2').textContent = (lang==='ar'
        ? 'Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© ÙŠÙ†ØªØ¬ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø±ØªØ¨Ø© (Ø±Ø£Ø³ + ØªÙ‚ÙˆÙŠÙ… + Ø¯Ù„ÙŠÙ„ + Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª).'
        : 'Image export produces a clean card with header, calendar, legend, and stats.');
      document.getElementById('tip3').textContent = (lang==='ar'
        ? 'Ø§Ø³ØªØ®Ø¯Ù… ØªØµØ¯ÙŠØ± ICS Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ø¥Ù„Ù‰ ØªÙ‚ÙˆÙŠÙ… Apple/Google/Outlook.'
        : 'Use ICS export to add shifts to Apple/Google/Outlook calendars.');

      document.getElementById('tipsOk').textContent = 'OK';

      const ml=document.getElementById('monthLbl');
      if(ml) ml.textContent = t('month');

      if(data) renderSchedule();
    }

    function toggleLang(){ lang = (lang==='en'?'ar':'en'); applyLangUI(); }

    /* Navigation */
    function goBack(){
      const base = location.pathname.includes('/roster-site/') ? '/roster-site/' : '/';
      if(document.referrer && document.referrer.includes(location.host)) history.back();
      else location.href = base;
    }

    /* Tips modal */
    function openTips(){ document.getElementById('tipsModal').style.display='flex'; }
    function closeTips(){ document.getElementById('tipsModal').style.display='none'; }
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeTips(); });

    /* Load schedule */
    document.getElementById('searchForm').addEventListener('submit', async (e)=>{
      const btn = document.activeElement;
      if(btn && btn.id === 'sbtn' && btn.textContent.includes('â”')){
        // If user clicks question mark area, open tips with Alt key
        if(e.altKey){ e.preventDefault(); openTips(); return; }
      }
      e.preventDefault();
      const id = document.getElementById('empId').value.trim();
      if(id) await loadSchedule(id);
    });

    async function loadSchedule(id){
      document.getElementById('area').innerHTML = `
        <div class="card state">
          <div class="spin"></div>
          <h3>${t('loading')}</h3>
          <p>${lang==='ar'?'Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø§Øªâ€¦':'Please wait a momentâ€¦'}</p>
        </div>`;

      try{
        const res = await fetch(`../schedules/${id}.json`);
        if(!res.ok) throw new Error('not found');
        data = await res.json();

        months = Object.keys(data.schedules || {}).sort();
        if(!months.length) throw new Error('empty schedules');

        const savedId = localStorage.getItem('savedEmpId');
        if(!savedId) showSaveToast(id, data.name);

        const now = new Date();
        const cur = now.getFullYear() + '-' + String(now.getMonth()+1).padStart(2,'0');
        month = months.includes(cur) ? cur : months[months.length-1];

        renderSchedule();
      }catch(err){
        document.getElementById('area').innerHTML = `
          <div class="card state">
            <div class="state-ico">âŒ</div>
            <h3>${t('notFound')}</h3>
            <p>${t('notFoundSub')}</p>
          </div>`;
      }
    }

    /* Save ID toast */
    function showSaveToast(id, name){
      const mount = document.getElementById('toastMount');
      const first = (name ? name.split(' ')[0] : id);
      mount.style.display='flex';
      mount.innerHTML = `
        <div class="toast-card" id="saveToast">
          <div class="toast-row">
            <div class="toast-ico">ğŸ’¾</div>
            <div>
              <p><strong>${t('saveTitle')}</strong><br>
              ${lang==='ar' ? 'Ù‡Ù„ Ø£Ù†Øª ' : 'Are you '}<strong>${esc(first)}</strong>? ${t('saveSub')}</p>
            </div>
          </div>
          <div class="toast-actions">
            <button class="tbtn primary" onclick="confirmSave('${id}')">${t('saveYes')}</button>
            <button class="tbtn" onclick="dismissToast()">${t('saveNo')}</button>
          </div>
        </div>`;
      setTimeout(()=>dismissToast(), 10000);
    }
    function confirmSave(id){ localStorage.setItem('savedEmpId', id); dismissToast(); if(data) renderSchedule(); }
    function dismissToast(){ const mount=document.getElementById('toastMount'); mount.innerHTML=''; mount.style.display='none'; }

    function changeMyId(){
      const msg = (lang==='ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸ØŸ' : 'Change your saved Employee ID?');
      if(confirm(msg)){ localStorage.removeItem('savedEmpId'); if(data) renderSchedule(); }
    }
    function setAsMyId(){ if(data && data.id){ localStorage.setItem('savedEmpId', data.id); if(data) renderSchedule(); } }

    /* Stats & helpers */
    function calcStats(s){
      const r={work:0,off:0,morning:0,afternoon:0,night:0,standby:0,leaves:0};
      s.forEach(d=>{
        if(d.shift_group==='Morning') r.morning++;
        else if(d.shift_group==='Afternoon') r.afternoon++;
        else if(d.shift_group==='Night') r.night++;
        else if(d.shift_group==='Off Day') r.off++;
        else if(d.shift_group==='Standby') r.standby++;
        else if(d.shift_group==='Annual Leave' || d.shift_group==='Sick Leave') r.leaves++;
      });
      r.work = r.morning + r.afternoon + r.night;
      return r;
    }
    function shiftClass(g){
      return {
        Morning:'s-morning',Afternoon:'s-afternoon',Night:'s-night',
        'Off Day':'s-off','Annual Leave':'s-leave','Sick Leave':'s-leave',
        Training:'s-training',Standby:'s-standby',Other:'s-other'
      }[g] || 's-other';
    }

    function statsAccordion(stats){
      const items = [
        {k:'work', open:true},
        {k:'morning', open:false},
        {k:'afternoon', open:false},
        {k:'night', open:false},
        {k:'off', open:false},
        {k:'standby', open:false},
        {k:'leaves', open:false},
      ];
      const metaByK = Object.fromEntries(STAT_META.map(m=>[m.k,m]));
      return items.map(it=>{
        const m = metaByK[it.k];
        const label = (lang==='ar' ? m.label_ar : m.label_en);
        const val = stats[it.k];
        const openAttr = it.open ? 'open' : '';
        return `
          <details class="acc-item" ${openAttr}>
            <summary>
              <div class="acc-left">
                <div class="acc-ico" style="background:${m.bg}">${m.icon}</div>
                <div class="acc-lbl">${label}</div>
              </div>
              <div class="acc-val">${val}</div>
            </summary>
            <div class="acc-body">
              ${lang==='ar' ? 'Ø§Ø¶ØºØ· Ù„Ø·ÙŠ/ÙØªØ­ Ø§Ù„Ø¹Ù†ØµØ±.' : 'Tap to fold/unfold.'}
            </div>
          </details>
        `;
      }).join('');
    }

    /* Render schedule */
    function renderSchedule(){
      const sched = data.schedules[month] || [];
      const [yr, mo] = month.split('-').map(Number);
      const ci = months.indexOf(month);
      const hasPrev = ci>0, hasNext = ci<months.length-1;

      const firstDow = new Date(yr, mo-1, 1).getDay();
      const dim = new Date(yr, mo, 0).getDate();
      const now = new Date();

      // Month select options
      const monthOpts = months.map(m=>{
        const p=m.split('-').map(Number);
        const label = `${T[lang].months[p[1]-1]} ${p[0]}`;
        return `<option value="${m}" ${m===month?'selected':''}>${label}</option>`;
      }).join('');

      // Show month row
      const mr=document.getElementById('monthRow');
      mr.style.display='flex';
      const sel=document.getElementById('mSel');
      sel.innerHTML = monthOpts;
      document.getElementById('mPrev').disabled = !hasPrev;
      document.getElementById('mNext').disabled = !hasNext;

      // Banner actions
      const savedId = localStorage.getItem('savedEmpId');
      const isMyId = savedId === data.id;
      const changeBtn = isMyId
        ? `<button class="btn2" type="button" onclick="changeMyId()">âœï¸ ${t('changeId')}</button>`
        : (!savedId ? '' : `<button class="btn2" type="button" onclick="setAsMyId()">ğŸ“Œ ${t('setAsMyId')}</button>`);

      const initials = (data.name || '?').split(' ').slice(0,2).map(w=>w[0]).join('').toUpperCase();

      // Calendar cells
      let cells='', dc=1;
      for(let w=0; w<6; w++){
        for(let d=0; d<7; d++){
          if((w===0 && d<firstDow) || dc>dim){
            cells += `<div class="day empty"></div>`;
          }else{
            const dd = sched.find(s => s.day===dc);
            const sc = dd ? shiftClass(dd.shift_group) : '';
            const icon = dd ? (COLORS[dd.shift_group]?.icon || '') : '';
            const code = (dd && dd.shift_code) ? `<span class="tag">${esc(dd.shift_code)}</span>` : '';
            const isToday = (now.getFullYear()===yr && (now.getMonth()+1)===mo && now.getDate()===dc);
            cells += `
              <div class="day ${sc} ${isToday?'today':''}">
                <div class="top">
                  <div class="dnum">${dc}</div>
                  <div class="ico" aria-hidden="true">${icon || ''}</div>
                </div>
                <div>${code}</div>
              </div>`;
            dc++;
          }
        }
        if(dc>dim) break;
      }

      // Day headers
      const dayHdr = T[lang].days.map(d=>`<div>${d}</div>`).join('');

      // Legend (used shift types)
      const used = [...new Set(sched.map(s=>s.shift_group))];
      const legHTML = used.map(g=>{
        const c=COLORS[g]; if(!c) return '';
        return `<span class="leg"><span class="l-dot" style="background:${c.dot}"></span>${esc(T[lang].legend[g] || g)}</span>`;
      }).join('');

      const stats = calcStats(sched);

      document.getElementById('area').innerHTML = `
        <div class="banner">
          <div class="bLeft">
            <div class="avatar">${esc(initials)}</div>
            <div style="min-width:0">
              <div class="bName">${esc(data.name)}</div>
              <div class="bMeta">
                <span class="badge">ğŸ“‹ ${t('dept')}: ${esc(data.department)}</span>
                <span class="badge">ğŸ†” ${t('id')}: ${esc(data.id)}</span>
              </div>
            </div>
          </div>
          <div class="bRight">
            ${changeBtn}
          </div>
        </div>

        <section class="mainGrid">
          <div class="stack">
            <div class="card cal">
              <div class="cal-head">${dayHdr}</div>
              <div class="cal-body">${cells}</div>
            </div>

            <div class="card">
              <div class="panel-head">
                <div class="panel-title">${t('legendTitle')}</div>
                <span class="pill">ğŸ·ï¸</span>
              </div>
              <div class="legend">
                <div class="legend-grid">${legHTML || `<span class="leg"><span class="l-dot" style="background:#cbd5e1"></span>${lang==='ar'?'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª':'No data'}</span>`}</div>
              </div>
            </div>

            <div class="card">
              <div class="panel-head">
                <div class="panel-title">${t('actionsTitle')}</div>
                <span class="pill">â¬‡ï¸</span>
              </div>
              <div class="toolbar">
                <button class="toolbtn primary" type="button" onclick="dlPDF()"><span class="ti">ğŸ“„</span>${t('pdf')}</button>
                <button class="toolbtn" type="button" onclick="dlIMG()"><span class="ti">ğŸ–¼ï¸</span>${t('img')}</button>
                <button class="toolbtn" type="button" onclick="dlICS()"><span class="ti">ğŸ“†</span>${t('ics')}</button>
                <button class="toolbtn" type="button" onclick="shareS()"><span class="ti">ğŸ”—</span>${t('share')}</button>
                <button class="toolbtn" type="button" onclick="window.print()"><span class="ti">ğŸ–¨ï¸</span>${t('print')}</button>
              </div>
            </div>
          </div>

          <aside class="statsSide card">
            <div class="panel-head">
              <div class="panel-title">${t('statsTitle')}</div>
              <span class="pill">ğŸ“Š</span>
            </div>
            <div class="acc">
              ${statsAccordion(stats)}
            </div>
          </aside>
        </section>
      `;
    }

    function chMonth(dir){
      const ci=months.indexOf(month), ni=ci+dir;
      if(ni>=0 && ni<months.length){ month=months[ni]; renderSchedule(); }
    }
    function jumpMonth(val){
      if(months.includes(val)){ month=val; renderSchedule(); }
    }

    /* IMAGE DOWNLOAD (clean export card) */
    async function dlIMG(){
      if(!window.html2canvas){ alert('Image library loading, please try again.'); return; }
      const calEl=document.querySelector('.cal');
      if(!calEl){ alert('No calendar to capture.'); return; }

      const sched = data.schedules[month] || [];
      const [yr, mo] = month.split('-').map(Number);
      const mName = `${T[lang].months[mo-1]} ${yr}`;
      const stats = calcStats(sched);
      const used = [...new Set(sched.map(s=>s.shift_group))];
      const W = Math.max(Math.min(calEl.offsetWidth, 1000), 760);

      const wrap = document.createElement('div');
      wrap.dir = (lang==='ar'?'rtl':'ltr');
      wrap.style.cssText = `
        position:fixed; left:-9999px; top:0;
        width:${W}px;
        background:#f6f8fc;
        font-family:"Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        border-radius:24px;
        overflow:hidden;
        border:1px solid #e6ebf2;
      `;

      const initials=(data.name||'?').split(' ').slice(0,2).map(w=>w[0]).join('').toUpperCase();
      const hdr = document.createElement('div');
      hdr.style.cssText = `
        background:linear-gradient(135deg,#0a1628,#153257);
        padding:18px 20px;
        display:flex; align-items:center; justify-content:space-between;
        gap:14px;
      `;
      hdr.innerHTML = `
        <div style="display:flex; align-items:center; gap:12px; min-width:0">
          <div style="width:50px;height:50px;border-radius:18px;background:linear-gradient(135deg,#1d4ed8,#06b6d4);display:grid;place-items:center;color:#fff;font-weight:1000;font-size:18px;flex:0 0 auto">${esc(initials)}</div>
          <div style="min-width:0">
            <div style="color:#fff;font-size:20px;font-weight:1000;letter-spacing:-.25px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:${Math.max(280, W-340)}px">${esc(data.name)}</div>
            <div style="color:rgba(255,255,255,.72);font-size:11px;font-weight:800;margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">
              ğŸ“‹ ${esc(data.department)} Â· ğŸ†” ${esc(data.id)}
            </div>
          </div>
        </div>
        <div style="background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);color:#fff;border-radius:16px;padding:10px 14px;font-size:13px;font-weight:1000;white-space:nowrap">
          ${esc(mName)}
        </div>
      `;
      wrap.appendChild(hdr);

      const calWrap = document.createElement('div');
      calWrap.style.cssText = `padding:16px 16px 10px;background:#fff;`;
      const calClone = calEl.cloneNode(true);
      calClone.style.cssText = `border-radius:18px; overflow:hidden; border:1px solid #e6ebf2; box-shadow:none;`;
      calClone.querySelectorAll('.day').forEach(d=>{
        d.style.boxShadow='none';
        d.style.transform='none';
      });
      calWrap.appendChild(calClone);
      wrap.appendChild(calWrap);

      const leg = document.createElement('div');
      leg.style.cssText = `padding:0 16px 14px; background:#fff; display:flex; flex-wrap:wrap; gap:8px;`;
      used.forEach(g=>{
        const c=COLORS[g]; if(!c) return;
        const item=document.createElement('span');
        item.style.cssText='display:inline-flex;align-items:center;gap:7px;border:1px solid #e6ebf2;background:#fff;border-radius:999px;padding:7px 10px;font-size:11px;font-weight:900;color:#64748b;white-space:nowrap';
        item.innerHTML=`<span style="width:10px;height:10px;border-radius:4px;background:${c.dot};display:inline-block"></span>${esc(T[lang].legend[g] || g)}`;
        leg.appendChild(item);
      });
      wrap.appendChild(leg);

      const stWrap=document.createElement('div');
      stWrap.style.cssText='background:#f6f8fc;padding:14px 16px 18px;border-top:1px solid #eef2f7;';
      const stTitle=document.createElement('div');
      stTitle.style.cssText='font-size:10px;font-weight:1000;color:#94a3b8;text-transform:uppercase;letter-spacing:.9px;margin-bottom:10px';
      stTitle.textContent = t('statsTitle');
      stWrap.appendChild(stTitle);

      const stRow=document.createElement('div');
      stRow.style.cssText='display:flex;gap:10px;flex-wrap:wrap;';

      const statCards = [
        {k:'work', c:'#1d4ed8'},
        {k:'off', c:'#64748b'},
        {k:'morning', c:'#b45309'},
        {k:'afternoon', c:'#c2410c'},
        {k:'night', c:'#5b21b6'},
        {k:'standby', c:'#be185d'},
        {k:'leaves', c:'#15803d'}
      ];
      const metaByK = Object.fromEntries(STAT_META.map(m=>[m.k,m]));
      statCards.forEach(meta=>{
        const m=metaByK[meta.k];
        const label=(lang==='ar'?m.label_ar:m.label_en);
        const box=document.createElement('div');
        box.style.cssText=`flex:1;min-width:140px;background:#fff;border:1px solid #e6ebf2;border-radius:16px;padding:12px 10px;text-align:center;border-top:4px solid ${meta.c};`;
        box.innerHTML=`<div style="font-size:22px;font-weight:1000;color:${meta.c};line-height:1">${stats[meta.k]}</div>
                       <div style="font-size:10px;font-weight:900;color:#94a3b8;margin-top:6px">${esc(label)}</div>`;
        stRow.appendChild(box);
      });

      stWrap.appendChild(stRow);
      wrap.appendChild(stWrap);

      document.body.appendChild(wrap);
      try{
        const canvas = await html2canvas(wrap, {scale:3, useCORS:true, backgroundColor:'#f6f8fc', logging:false});
        const a=document.createElement('a');
        a.download = `schedule-${data.id}-${month}-${lang}.png`;
        a.href = canvas.toDataURL('image/png');
        a.click();
      }catch(e){
        alert('Image capture failed: ' + e.message);
      }finally{
        document.body.removeChild(wrap);
      }
    }

    /* ICS */
    function dlICS(){
      const sched=data.schedules[month] || [];
      const [yr,mo]=month.split('-').map(Number);
      const pad=n=>String(n).padStart(2,'0');
      const lines=['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//MySchedule//EN','CALSCALE:GREGORIAN'];
      sched.forEach(d=>{
        const dt=`${yr}${pad(mo)}${pad(d.day)}`;
        const dtNext=new Date(yr,mo-1,d.day+1);
        const dtE=`${dtNext.getFullYear()}${pad(dtNext.getMonth()+1)}${pad(dtNext.getDate())}`;
        const sum=d.shift_code||d.shift_group;
        lines.push('BEGIN:VEVENT',`DTSTART;VALUE=DATE:${dt}`,`DTEND;VALUE=DATE:${dtE}`,`SUMMARY:${sum}`,`UID:${dt}-${data.id}-${d.day}@myschedule`,'END:VEVENT');
      });
      lines.push('END:VCALENDAR');
      const blob=new Blob([lines.join('\\r\\n')],{type:'text/calendar'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
      a.download=`schedule-${data.id}-${month}.ics`; a.click();
      URL.revokeObjectURL(a.href);
    }

    /* PDF (keep stable A4 calendar export) */
    function dlPDF(){
      if(!window.jspdf){ alert('PDF library loading, please try again.'); return; }
      const {jsPDF}=window.jspdf;
      const doc=new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});

      const W=210,H=297,ML=7,MR=7;
      const sched=data.schedules[month] || [];
      const [yr,mo]=month.split('-').map(Number);
      const mName=T.en.months[mo-1];
      const stats=calcStats(sched);

      const SC={Morning:{fg:[200,90,0],bg:[255,243,224]},Afternoon:{fg:[180,45,5],bg:[255,235,218]},Night:{fg:[20,55,190],bg:[224,230,255]},
                'Off Day':{fg:[85,95,115],bg:[238,240,245]},'Annual Leave':{fg:[10,125,60],bg:[218,248,230]},'Sick Leave':{fg:[10,125,60],bg:[218,248,230]},
                Training:{fg:[10,85,190],bg:[218,238,255]},Standby:{fg:[148,10,110],bg:[250,218,242]},Other:{fg:[90,100,115],bg:[240,241,246]}};
      const FALLBACK={'Off Day':'OFF','Annual Leave':'LV','Sick Leave':'SL',Training:'TR',Standby:'ST',Other:'â€”'};
      const LNAMES={Morning:'Morning',Afternoon:'Afternoon',Night:'Night','Off Day':'Day Off','Annual Leave':'Leave','Sick Leave':'Sick',Training:'Training',Standby:'Standby',Other:'Other'};
      const NAVY=[10,22,40],WHITE=[255,255,255],RULE=[195,202,215],EMPTY=[244,245,249],DIM=[105,115,132];

      const HDR_H=30,CAL_HDR=9,STATS_H=42,FOOT_H=10,GAP1=3,GAP2=4;
      const CAL_TOP=HDR_H+GAP1,STATS_TOP=H-FOOT_H-GAP2-STATS_H,CAL_BOT=STATS_TOP-GAP2,CAL_BODY=CAL_BOT-CAL_TOP-CAL_HDR;

      const firstDow=new Date(yr,mo-1,1).getDay(),dim=new Date(yr,mo,0).getDate();

      // rows
      let nRows=0;{
        let d2=1;
        for(let w=0;w<6;w++){
          let any=false;
          for(let d=0;d<7;d++){
            if(!((w===0&&d<firstDow)||d2>dim)){ any=true; d2++; }
          }
          if(any) nRows++;
          if(d2>dim) break;
        }
      }
      const CH=Math.floor(CAL_BODY/nRows), CW=(W-ML-MR)/7;

      // header
      doc.setFillColor(...NAVY); doc.rect(0,0,W,HDR_H,'F');
      doc.setTextColor(...WHITE); doc.setFontSize(17); doc.setFont(undefined,'bold'); doc.text(String(data.name),ML,13);
      doc.setFontSize(8.5); doc.setFont(undefined,'normal'); doc.setTextColor(165,188,235);
      doc.text(`${data.department}   Â·   ID: ${data.id}`,ML,21);

      doc.setFillColor(...WHITE);
      doc.roundedRect(W-MR-55,9,55,14,3,3,'F');
      doc.setTextColor(...NAVY); doc.setFontSize(10.5); doc.setFont(undefined,'bold');
      doc.text(`${mName}  ${yr}`,W-MR-27.5,18,{align:'center'});

      // day header
      doc.setFillColor(...NAVY); doc.rect(ML,CAL_TOP,W-ML-MR,CAL_HDR,'F');
      ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach((d,i)=>{
        doc.setTextColor(...WHITE); doc.setFontSize(8.5); doc.setFont(undefined,'bold');
        doc.text(d,ML+i*CW+CW/2,CAL_TOP+6.3,{align:'center'});
      });

      // cells
      let dc=1,row=0; doc.setLineWidth(0.22);
      for(let w=0;w<6;w++){
        for(let d=0;d<7;d++){
          const cx=ML+d*CW, cy=CAL_TOP+CAL_HDR+row*CH;
          const isEmpty=(w===0&&d<firstDow)||dc>dim;
          if(isEmpty){
            doc.setFillColor(...EMPTY); doc.setDrawColor(...RULE); doc.rect(cx,cy,CW,CH,'FD');
            continue;
          }
          const dd=sched.find(s=>s.day===dc), sh=dd?(SC[dd.shift_group]||SC.Other):null;
          doc.setFillColor(...(sh?sh.bg:WHITE)); doc.setDrawColor(...RULE); doc.rect(cx,cy,CW,CH,'FD');

          // ghost day number
          const numStr=String(dc);
          let ghostR,ghostG,ghostB;
          if(sh){
            ghostR=Math.round(sh.bg[0]*0.55+sh.fg[0]*0.45);
            ghostG=Math.round(sh.bg[1]*0.55+sh.fg[1]*0.45);
            ghostB=Math.round(sh.bg[2]*0.55+sh.fg[2]*0.45);
          }else{
            ghostR=210; ghostG=215; ghostB=225;
          }
          const ghostSize=Math.round(CH*0.72);
          doc.setTextColor(ghostR,ghostG,ghostB);
          doc.setFontSize(ghostSize>38?38:ghostSize<22?22:ghostSize);
          doc.setFont(undefined,'bold');
          doc.text(numStr,cx+2.5,cy+ghostSize*0.72,{align:'left'});

          if(dd){
            const code=dd.shift_code||(FALLBACK[dd.shift_group]||'');
            if(code){
              const fs=CH>=36?20:CH>=28?18:15;
              doc.setTextColor(...sh.fg);
              doc.setFontSize(fs);
              doc.setFont(undefined,'bold');
              doc.text(code,cx+CW/2,cy+CH*0.67,{align:'center'});
            }
          }
          dc++;
        }
        if(dc>dim) break;
        row++;
      }

      // stats footer
      doc.setDrawColor(...RULE); doc.setLineWidth(0.3); doc.line(ML,STATS_TOP,W-MR,STATS_TOP);
      doc.setTextColor(...NAVY); doc.setFontSize(8); doc.setFont(undefined,'bold'); doc.text('STATISTICS',ML,STATS_TOP+5);

      const SL=[
        {l:'Work Days',v:stats.work,c:NAVY},{l:'Day Off',v:stats.off,c:[85,95,115]},
        {l:'Morning',v:stats.morning,c:[200,90,0]},{l:'Afternoon',v:stats.afternoon,c:[180,45,5]},
        {l:'Night',v:stats.night,c:[20,55,190]},{l:'Standby',v:stats.standby,c:[148,10,110]},
        {l:'Leaves',v:stats.leaves,c:[10,125,60]}
      ];
      const nSt=SL.length, SGAP=2, sW=(W-ML-MR-(nSt-1)*SGAP)/nSt, CARD_Y=STATS_TOP+7, CARD_H=22;

      SL.forEach(({l,v,c},i)=>{
        const sx=ML+i*(sW+SGAP);
        doc.setFillColor(247,248,253);
        doc.setDrawColor(...RULE);
        doc.setLineWidth(0.2);
        doc.roundedRect(sx,CARD_Y,sW,CARD_H,2,2,'FD');
        doc.setFillColor(...c);
        doc.roundedRect(sx,CARD_Y,sW,3,1,1,'F');
        doc.setTextColor(...c);
        doc.setFontSize(18);
        doc.setFont(undefined,'bold');
        doc.text(String(v),sx+sW/2,CARD_Y+15,{align:'center'});
        doc.setTextColor(...DIM);
        doc.setFontSize(5.8);
        doc.setFont(undefined,'bold');
        doc.text(l,sx+sW/2,CARD_Y+20.5,{align:'center'});
      });

      const LY=CARD_Y+CARD_H+3;
      const used=[...new Set(sched.map(s=>s.shift_group))];
      const lStep=(W-ML-MR)/Math.max(used.length,1);

      used.forEach((g,i)=>{
        const sh2=SC[g]||SC.Other;
        const lx=ML+i*lStep;
        doc.setFillColor(...sh2.bg);
        doc.setDrawColor(...sh2.fg);
        doc.setLineWidth(0.5);
        doc.roundedRect(lx,LY,lStep-2,6,1.5,1.5,'FD');
        doc.setTextColor(...sh2.fg);
        doc.setFontSize(6.5);
        doc.setFont(undefined,'bold');
        doc.text(LNAMES[g]||g,lx+(lStep-2)/2,LY+4.1,{align:'center'});
      });

      // footer
      doc.setDrawColor(...RULE); doc.setLineWidth(0.25); doc.line(ML,H-6,W-MR,H-6);
      doc.setTextColor(...DIM); doc.setFontSize(7); doc.setFont(undefined,'normal');
      doc.text('My Schedule',ML,H-2.5);
      doc.text(`${mName} ${yr}  Â·  ${data.id}`,W-MR,H-2.5,{align:'right'});

      doc.save(`schedule-${data.id}-${month}.pdf`);
    }

    /* SHARE */
    function shareS(){
      const id=data.id;
      const base=location.pathname.includes('/roster-site/')?'/roster-site/':'/';
      const url=`${location.origin}${base}my-schedules/?emp=${encodeURIComponent(id)}`;
      if(navigator.share){
        navigator.share({title:'My Schedule',text:`Schedule: ${data.name}`,url});
      }else{
        navigator.clipboard.writeText(url);
        alert(lang==='ar' ? 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· âœ…' : 'Link copied âœ…');
      }
    }

    /* Init */
    applyLangUI();
    const p=new URLSearchParams(location.search).get('emp');
    if(p){
      document.getElementById('empId').value=p;
      loadSchedule(p);
    }else{
      const saved=localStorage.getItem('savedEmpId');
      if(saved){
        document.getElementById('empId').value=saved;
        loadSchedule(saved);
      }
    }
  </script>
</body>
</html>
